# Register for `fclose()` â€” `check::PreCall`ì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ 

---

## ğŸ§  ë¨¼ì € êµ¬ì¡°ë¶€í„°

```cpp
class SimpleStreamChecker : public Checker< check::PostCall,      // fopenìš© 
                                            check::PreCall > {    // fcloseìš©

public:  
void checkPostCall(const CallEvent &Call, CheckerContext &C) const; // fopen 
void checkPreCall(const CallEvent &Call, CheckerContext &C) const;  // fclose 
};`
```


- `check::PostCall`: **í•¨ìˆ˜ í˜¸ì¶œ ì§í›„** ê°œì… ê°€ëŠ¥ â†’ `fopen()` ë¶„ì„ì— ì í•©
- `check::PreCall`: **í•¨ìˆ˜ í˜¸ì¶œ ì§ì „** ê°œì… ê°€ëŠ¥ â†’ `fclose()` ë¶„ì„ì— ì í•©

 ì™œ `fclose()`ëŠ” `PreCall`ì—ì„œ ì²˜ë¦¬í•˜ë‚˜?

>**ì‹¤í–‰í•˜ê¸° ì „ì—**,  
  í•´ë‹¹ í•¸ë“¤ì´ **ì •ë§ ì—´ë ¤ ìˆëŠ”ì§€**ë¥¼ ë¯¸ë¦¬ í™•ì¸í•˜ê³  ì‹¶ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.


```cpp
void SimpleStreamChecker::checkPreCall(const CallEvent &Call, 
                                              CheckerContext &C) const { 


if (!Call.isGlobalCFunction("fclose") || Call.getNumArgs() != 1) return; 

// Get the symbolic value corresponding to the file handle. 
SymbolRef FileDesc = Call.getArgSVal(0).getAsSymbol(); 
//fclose(fp)ì—ì„œ ì²« ë²ˆì§¸ ì¸ìì¸ fpë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.

//getAsSymbol()ì´ ì‹¤íŒ¨í•˜ë©´ â†’ ì´ ê°’ì€ ì¶”ì  ë¶ˆê°€ëŠ¥í•œ ê°’
if (!FileDesc) return;

// Generate the next transition, in which the stream is closed.
// ìƒíƒœê°€ ë°”ë€Œì—ˆìœ¼ë‹ˆ, ë¶„ì„ ê²½ë¡œ ê·¸ë˜í”„ì— ìƒˆ ë…¸íŠ¸(edge)ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
ProgramStateRef State = C.getState(); 
State = State->set<StreamMap>(FileDesc, StreamState::getClosed());
C.addTransition(State); 
}
```


- ì´ë²¤íŠ¸ ìœ í˜•ë³„ ê³ ì •ëœ ì´ë¦„ ê·œì¹™:
- ì´ë¦„ ë¶ˆì¼ì¹˜ ì‹œ ë°”ì¸ë”© ì‹¤íŒ¨

| ì´ë²¤íŠ¸ ìœ í˜•             | í•„ìˆ˜ í•¨ìˆ˜ëª…           |
| ------------------ | ---------------- |
| check::PostCall    | checkPostCall    |
| check::PreCall     | checkPreCall     |
| check::DeadSymbols | checkDeadSymbols |
```cpp
void checkPostCall(const CallEvent &Call, CheckerContext &C) const;
//         â–²              â–²                  â–²              â–²
//      í•¨ìˆ˜ëª…       CallEvent ì°¸ì¡°     CheckerContext ì°¸ì¡°  const ì„ ì–¸
```

Clangì˜Â **Convention Over Configuration**Â ì›ì¹™ì„ êµ¬í˜„í•©ë‹ˆë‹¤. ì‚¬ìš©ìëŠ” ë³µì¡í•œ ë“±ë¡ ë¡œì§ ì—†ì´ ê·œì¹™ë§Œ ì¤€ìˆ˜í•˜ë©´ ë¶„ì„ê¸°ê°€ ìë™ìœ¼ë¡œ ì½œë°±ì„ ê´€ë¦¬í•©ë‹ˆë‹¤