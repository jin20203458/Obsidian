
모두 완료되었을까?   Test해보자.

#### ???
![[Pasted image 20250701132424.png]]

- **거짓 양성**(false positive)을 확인할수 있다.

![[Pasted image 20250701132221.png]]
- fopen이 성공했을 경우에는 닫지 않으면 Leaked 가 발생하지만 fopen이 실패했다면?
  그럼 닫지 않아도 된다.(에초에 파일이 열리지 않았으니까)

#### 1. **이전 버전 (거짓 양성 발생)**
```cpp
static bool isLeaked(SymbolRef Sym, const StreamState &SS, bool IsSymDead) {
  if (IsSymDead && SS.isOpened()) {
    return true; // 단순한 조건: 죽은 심볼 + 열린 상태 = 누수
  }
  return false;
}
```


#### 2. **개선된 버전 (거짓 양성 해결)**
```cpp
static bool isLeaked(SymbolRef Sym, const StreamState &SS,
                    bool IsSymDead, ProgramStateRef State) {
  if (IsSymDead && SS.isOpened()) {
    // 핵심 개선: 심볼이 NULL인지 확인
    ConstraintManager &CMgr = State->getConstraintManager();
    ConditionTruthVal OpenFailed = CMgr.isNull(State, Sym);
    return !OpenFailed.isConstrainedTrue(); // NULL이 아닌 경우만 누수
  }
  return false;
}

```