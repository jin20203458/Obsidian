실세계의 사물은 고유의 색상을 가진다. 색상이란 물체 자체에서 나오는 것이 아니라 물체 표면이 주변에 존재하는 빛의 성분 중 어떤 것을 반사하는가로 결정된다. 빨간색을 잘 반사하면 빨간색 물체로 보이고 모든 빛을 잘 반사하면 흰색이며 모든 빛을 흡수하면 검정색이다. 눈이 인식하는 색상은 여러 빛의 혼합과 물체의 색상 반사 재질에 의해 결정된다.

한 물체의 색상은 굉장히 다양한 요소들에 의해 복잡하게 결정되므로 단일한 색인 경우보다 여러 색이 섞여 보이는 것이 일반적이다. 3D 그래픽은 실세계의 사물을 화면에 그려내는 기술이다. 사실적인 표현을 위해서는 주변빛에 따라 물체의 색상을 사실적으로 그려내야 한다. OpenGL은 이를 위해 조명을 성격에 따라 다음 세가지로 분류한다. 조명의 성질에 따라 물체의 색상에 끼치는 영향이 다르다.

물체의 색을 바꾸는 것은 조명이 백색광일때 반사하는 빛을 지정하는것이라고 할수있고,
조명의 색을 바꾸는것은 애초에 반사할수 있는 (없는 빛을 반사하지는 못함으로) 지정하는것이라고도 할수 있다.

■ 주변광(Ambient) : 도처에 존재하는 빛이다. 광원에서 나온 빛이 여러 경로로 반사 및 재 반사되어 방향성을 잃어 버린 빛이다. 사방에서 물체의 모든 면에 골고루 비쳐지며 밝기도 일정하다.

■ 분산광(Diffuse) : 한 방향으로 들어와서 물체의 표면에 반사되어 여러 방향으로 흩어지는 빛이다. 빛을 받는 부분이 그렇지 않은 부분에 비해 훨씬 더 밝게 보인다. 형광등 불빛이 대표적이다.

■ 반사광(Specular) : 한 방향으로 들어와서 한 방향으로만 반사되는 빛이다. 강한 후레쉬 불빛이나 레이저 광선이 이에 해당한다.

빛을 내는 광원은 특정 한 조명에 속하지 않고 이 세가지 조명을 적절히 혼합한 상태이되 성질에 따라 특정 조명의 비율이 다르다. 예를 들여 야외의 햇빛은 난반사되어 도처에 있는 주변광의 성질을 띄지만 틈새로 비치는 직사 광선은 반사광의 성질을 띄기도 한다. 조명 효과를 사용하려면 조명 기능을 켜야 한다.

glEnable(GL_LIGHTING);

OpenGL은 보통 GL_LIGHT0 ~ GL_LIGHT7까지 8개의 동시 조명을 지원하며 구현에 따라서는 더 많은 수의 조명을 지원하는 것도 있다. 모든 조명은 디폴트로 꺼져 있으므로 사용하고자 하는 조명을 개별적으로 켜 주어야 한다. 첫 번째 조명을 사용하려면 다음과 같이 호출한다.

1. glEnable(GL_LIGHT0);

즉, 조명을 사용하려면 **GL_LIGHTING으로 OpenGL 자체의 전체 조명 기능을 켜고**(1번) 사용하고자 하는 **번호의 조명(2번)도 켜야 하므**로 최소한 두번은 glEnable을 호출해야 한다. 각 조명에 대한 성질은 다음 함수로 지정한다.

2. void glLight[f, i] (GLenum light, GLenum pname, GLfloat param);

첫번째 인수는 설정하고자 하는 조명의 번호이다. GL_LIGHT0 ~ GL_LIGHT7중의 하나이다. pname은 설정할 속성의 이름이며 param은 속성의 값이다. 함수 하나로 파라미터를 바꾸어 가며 조명의 여러 가지 성질을 지정한다.

|속성|설명|
|---|---|
|**GL_AMBIENT**|주변광의 세기. `(r, g, b, a)` 배열로 각 색상 요소의 강도를 지정한다.|
|**GL_DIFFUSE**|분산광의 세기.|
|**GL_SPECULAR**|반사광의 세기.|
|**GL_POSITION**|조명의 `(x, y, z, w)` 위치.|
|**GL_SPOT_DIRECTION**|조명의 `(x, y, z)` 방향.|
|**GL_SPOT_EXPONENT**|스포트라이트 지수.|
|**GL_SPOT_CUTOFF**|스포트라이트의 확산 각도.|
|**GL_CONSTANT_ATTENUATION**|빛이 점점 흐려지는 감쇠율 (상수).|
|**GL_LINEAR_ATTENUATION**|빛이 점점 흐려지는 감쇠율 (선형).|
|**GL_QUADRATIC_ATTENUATION**|빛이 점점 흐려지는 감쇠율 (제곱).|
세가지 조명의 디폴트는 모두 (0,0,0,1) 즉, 검정색이다. 단 첫번째 조명인 GL_LIGHT0는 분산광과 조명광의 디폴트가 (1,1,1,1)로 되어 있다. 즉, 첫번째 조명만 디폴트로 하얀색이다. 


#### 조명 모델

다음 함수는 조명의 전역적인 성질을 지정한다. 특정 번호의 조명이 아니라 전역 설정이므로 장면 전체에 적용된다.

void glLightModel[f, i]  [v] (GLenum pname, const GLfloat *params);

pname은 지정할 속성이며 params는 속성의 값이다. 설정 가능한 속성은 다음 4가지가 있다.

|속성|설명|
|---|---|
|**GL_LIGHT_MODEL_AMBIENT**|특정 광원에 소속되지 않은 전역 주변광을 설정한다.|
|**GL_LIGHT_MODEL_COLOR_CONTROL**|반사광을 계산하는 것과 적용하는 것을 분리한다.|
|**GL_LIGHT_MODEL_LOCAL_VIEWER**|반사광의 각도를 어떻게 계산할 것인가를 지정한다. 이 값이 0이면 조명이 평행하게 비치고 0이 아니면 정점의 방향에 따라 비친다.|
|**GL_LIGHT_MODEL_TWO_SIDE**|물체의 뒷면에도 조명을 적용한다. 디폴트는 한쪽 면에만 조명이 적용된다.|

### 재질

물체의 최종 색상을 결정하는데는 조명보다 물체 자체의 성질이 더 중요하다. 조명은 단지 빛일 뿐이며 이 빛이 물체에 반사되어 망막으로 들어온 빛이 실제 색상으로 인식되기 때문이다. 똑같은 빛이라도 종이에 비춘 것과 유리에 비춘 것, 금속에 비춘 것 등의 효과가 다르게 나타난다. **각 조명의 어떤 색상 요소를 얼마나 반사할 것인가를 지정하는 성질을 물체의 재질이라고 한다.** 다음 함수로 각 다각형에 대해 재질을 지정한다.

void glMaterial[f, i]  [v] (GLenum face, GLenum pname, GLfloat* param);

face는 물체의 어떤 면에 대한 재질인지를 지정하는데 GL_FRONT, GL_BACK, GL_FRONT_AND_BACK 중 하나의 값을 전달한다. 앞뒷면에 대해 서로 다른 재질을 부여할 수도 있다. pname은 설정하고자 하는 속성이며 param은 속성의 값이다.

|속성|설명|
|---|---|
|**GL_AMBIENT**|주변광의 어느 색상 요소를 얼마만큼 반사할 것인가를 지정한다. 각 색상 요소에 대해 -1 ~ 1 사이의 범위를 가지며 디폴트는 (0.2, 0.2, 0.2, 1.0)이다.|
|**GL_DIFFUSE**|분산광에 대한 반사도를 지정한다. 디폴트는 (0.8, 0.8, 0.8, 1.0)이다.|
|**GL_AMBIENT_AND_DIFFUSE**|주변광과 분산광의 속성을 한꺼번에 조정한다.|
|**GL_SPECULAR**|반사광에 대한 반사도를 지정한다. 디폴트는 (0, 0, 0, 1)이다.|
|**GL_EMISSION**|방출 속성을 지정한다. 디폴트는 (0, 0, 0, 1)이다.|
|**GL_SHININESS**|반사광에 대해 반짝거리는 정도를 지정한다. 0 ~ 128 사이의 범위를 지정할 수 있으며 디폴트는 0이다.|
|**GL_COLOR_INDEXES**|주변광, 분산광, 반사광에 대한 색상 인덱스이다. 디폴트는 (0, 1, 1)이다.|
각 종류의 조명에 대해 또 각각의 색상 요소에 대한 반사도를 개별적으로 지정할 수 있다. 물체에 비치는 조명은 물론이고 3가지 조명에 대해 rgba 요소에 대한 반사도와 방출, 반짝임 등의 물체 재질까지 고려되므로 조명에 의한 색상을 결정하는데 20개 이상의 변수가 개입하는 셈이다. 

재질은 조명에 대한 반사도로 다각형의 색상을 지정하는 것이므로 glColor로 지정한 고유한 색상을 완전히 무시한다.
 
 glColor로 지정한 색상을 재질 대신 사용하려면 색상 트래킹(color tracking) 기능을 사용한다. 기능을 사용하려면 다음 두 함수를 호출한다.

glEnable(GL_COLOR_MATERIAL);
void glColorMaterial(GLenum face, GLenum mode);

이 기능의 이름이 의미하듯이 색상을 곧 재질로 사용하는 것이다. glColorMaterial 함수는 어떤 면에 어떤 조명을 적용할 것인가를 지정한다. face는 조명이 적용될 면이고 mode는 면에 적용할 조명의 종류이다.

팝업 메뉴에서 색상 트래킹 기능을 켜 보자. 이 옵션을 켜면 물체의 앞면에 대해 주변광을 적용한다. 각 면에 대해 재질을 밝힐 필요가 없으며 대신 glColor 함수로 색상을 밝혀야 한다. 각 면의 색상에 따라 재질이 결정되며 주변광의 밝기만 조정하면 전체적인 명도를 쉽게 조정할 수 있다.

### 법선

방향성이 있는 조명은 **각도에 따라 물체에 닿는 빛의 강도가 달라진다.** 후레쉬로 물체를 비출 때 수직으로 비추는 것과 비스듬하게 비출 때의 색상이 다르게 보이는 것과 같은 이치이다. 그래서 **조명에 의해 반사되는 빛의 양을 정확하게 계산하기 위해서는 조명과 물체면과의 각도를 알아야 한다.**

이 각도를 계산하는데 중요한 문제가 있다. 다각형을 구성하는 정점은 3차원 공간상의 위치만 가질 뿐 평면도 아니고 직선도 아니다. **빛은 직진하는 성질이 있으므로 직선이지만 정점은 그냥 위치일 뿐이다. 직선과 점 사이의 각도를 구하는 것은 수학적으로 불가능하다.** 각도라는 개념은 최소한 직선과 직선이 만나야만 측정 가능한 것이다. 그래서 **정점의 좌표만으로는 조명의 강도를 결정할 수 없으며 추가 정보가 더 필요하다.**

**정점의 조명 계산을 위한 이 추가 정보가 바로 법선 벡터(Normal Vector)이다.** 법선 벡터는 정점에서 수직으로 뻗어나가는 가상의 선이며 정점의 방향을 나타난다. 대개의 경우 정점이 속한 평면에 대해 위쪽으로 수직선을 그으면 되지만 문제가 그리 간단하지 않다. 곡면을 구성하는 다각형에 속한 정점들은 법선의 각도가 다 달라야 부드러운 곡면을 표현할 수 있다. **그래서 OpenGL은 법선에 대한 자동 계산을 지원하지 않으며 전적으로 개발자가 지정해야 한다. 법선은 다음 함수로 배치한다.**

void glNormal3[f,d,i,s,b]  [v] (GLfloat nx, GLfloat ny, GLfloat nz);

**정점 하나에 대해 법선을 지정하므로 이 함수는 주로 glVertex 함수와 쌍으로 호출된다.** 여러 개의 정점이 하나의 법선을 공유한다면 glNormal을 한번만 호출하고 glVertex로 정점을 계속 배치하면 된다. 즉, 법선도 한번 배치하면 다른 값으로 바꾸기전에는 계속 유효하다.

다음은 삼각형을 구성하는 정점의 법선을 구하는 공식이다. 세 개의 정점으로 구성된 삼각형의 경우 한 점에서 나머지 두 점으로 두 개의 벡터를 그릴 수 있다. 이 두 벡터의 외적(Cross Product)을 구하면 두 벡터에 수직인 벡터가 구해진다.

![](http://www.soen.kr/lecture/library/opengl/opengl-9.files/image018.gif)

V1 벡터가 (x1, y1, z1), V2 벡터가 (x2, y2, z2)일 때 두 벡터의 외적은 다음 공식으로 구할 수 있다. 이 공식은 수학책에 나와 있으므로 나한테 묻지 말고 홍성대 선생님께 문의하기 바란다. 또 벡터의 외적은 어째서 항상 두 벡터에 수직인지는 교양 물리학을 참고하도록 하자.

(y1z2 - z2y1, z1x2-x1z2, x1y2-y1x1)

OpenGL은 광원의 각도 계산을 단순화하기 위해 법선 벡터의 길이를 1로 지정할 것을 요구한다. 어차피 법선은 각도 계산을 위해 지정하는 것이고 각도 계산에 길이는 무의미하다. 길이가 1인 법선 벡터를 단위 법선 벡터라고 하며 길이를 1로 줄이는 것을 정규화라고 한다. 길이를 1로 줄이려면 먼저 벡터의 길이를 구해야 한다. 벡터의 길이는 피타고라스의 정리로 쉽게 구할 수 있다.

![](http://www.soen.kr/lecture/library/opengl/opengl-9.files/image020.gif)

법선 벡터의 좌표를 길이로 나누어 (x/len, y/len, z/len)을 취하면 단위 법선 벡터가 된다.  **모든 법선을 일일이 정규화하는 것이 귀찮다면 GL_NORMALIZE 기능을 켜 OpenGL이 법선을 정규화하도록 할 수도 있다.** 자동 정규화 기능을 사용하면 편리하지만 성능이 저하되는 단점이 있다. 